<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Music Recognizer</title>
</head>
<body>
    <h1>Распознать музыку</h1>
    <button id="recordBtn">Начать запись</button>
    <div id="result"></div>

    <script>
        let btn = document.getElementById('recordBtn');
        
        btn.onclick = async () => {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const mediaRecorder = new MediaRecorder(stream);
            const chunks = [];

            mediaRecorder.ondataavailable = e => chunks.push(e.data);
            mediaRecorder.onstop = async () => {
                const blob = new Blob(chunks, { type: 'audio/wav' });
                const formData = new FormData();
                formData.append('file', blob);

                const response = await fetch('/recognize', { method: 'POST', body: formData });
                const data = await response.json();
                document.getElementById('result').innerText = `Результат: ${data.match.artist} - ${data.match.title}`;
            };

            mediaRecorder.start();
            setTimeout(() => mediaRecorder.stop(), 5000); // Запись 5 секунд
        };
    </script>
</body>
</html>
